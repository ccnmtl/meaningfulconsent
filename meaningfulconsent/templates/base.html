{% load compress %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Precision in Pediatric Sequencing: {% block title %}{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Precision in Pediatric Sequencing">
  <meta name="author" content="CCNMTL">
  
  <!-- Bootstrap CSS: -->
  <link href="{{STATIC_URL}}bootstrap/css/bootstrap.min.css" rel="stylesheet">

  {% compress css %}
      <link href="{{STATIC_URL}}bootstrap/css/bootstrap-glyphicons.css" rel="stylesheet">
      <!-- Application CSS: -->
      <link href="{{STATIC_URL}}css/main.css" rel="stylesheet">
      {% block css %}{% endblock %}
  {% endcompress %}
  
  <link rel="shortcut icon" href="{{STATIC_URL}}img/favicon.ico" type="image/x-icon" />  
  <script src="{{STATIC_URL}}jquery/js/jquery-1.10.1.min.js"></script>
  {% block extrahead %}{% endblock %}
  {% block feeds %}{% endblock %}
</head>
<body class="{% block bodyclass %}{% endblock %}" id="{% block bodyid %}{% endblock %}">

{% block topnavbar %}
    <div class="navbar navbar-inverse navbar-pl" role="navigation">
        <div class="container container-header">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle"
                    data-toggle="collapse"
                    data-target="#navbar-collapse-pl">
                    <span class="sr-only">Toggle navigation</span> <span
                        class="icon-bar"></span> <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                
                {% if request.user.is_anonymous or not request.user.profile.is_participant %}
                    <a class="navbar-brand" href="/">Meaningful Consent</a>
                {% else %}
                    <span class="navbar-logo">Meaningful Consent</span>
                {% endif %}
            </div>

            <!--/.navbar-header -->
            <div class="collapse navbar-collapse" id="navbar-collapse-pl">
                <ul class="nav navbar-nav navbar-right navbar-nav-pl">
                    {% block usernav %}
                        {% if request.user.is_anonymous %}
                            <li><a href="#" data-toggle="modal"
                                data-target="#login-modal"
                                class="btn-log-in btn btn-sm">Log in</a>
                            </li>
                            <li><a href="/about/">About</a></li>
                            <li><a href="/credits/">Credits</a></li>
                            <li><a href="/contact/">Contact</a></li>
                            <li><a href="/help/">Help</a></li>
                        {% else %}{% if not request.user.profile.is_participant %}
                            <li class="logged-in-greeting">
                                <span>Hello, {% if user.first_name %}{{user.get_short_name}}{% else %}{{user.username}}{% endif %}</span>
                                <a href="/accounts/logout/?next=/"><span title="Log out">(log out)</span></a>
                            </li>
                            {% if user.has_usable_password %}
                                <li><a href="/accounts/password_change/">Change Password</a></li>
                            {% endif %}
                            <li><a href="/about/">About</a></li>
                            <li><a href="/credits/">Credits</a></li>
                            <li><a href="/contact/">Contact</a></li>
                            <li><a href="/help/">Help</a></li>
                        {% endif %}{% endif %}
                    {% endblock %}
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
        <!--/.container-header -->
    </div><!--/.navbar-pl -->
{% endblock %}


{% if request.user.is_anonymous or request.user.profile.is_participant %}
    <!-- Login Modal -->
    <div class="modal" id="login-modal" tabindex="-1" role="dialog" aria-labelledby="loginLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="loginLabel">Facilitator Log In</h4>
            </div><!-- /.modal-header -->
            <div class="modal-body">
                <form id="login-local" name="login_local" method="post" action="/accounts/login/" class="form-horizontal" role="form">
                    {% csrf_token %}
                    <div class="login-local-form">
                        <div class="local-login-errors alert alert-danger" style="display: none;">
                            <span><b>Invalid username or password.</b></span>
                            Please try again. Note that both username and password are case-sensitive.
                        </div>
                    
                        <div class="form-group">
                          <label for="id_username" class="col-sm-4 control-label">User Name</label>
                          <div class="col-sm-8">
                            {{ login_form.username }}
                          </div>
                        </div>
                    
                        <div class="form-group">
                          <label for="id_password" class="col-sm-4 control-label">Password</label>
                          <div class="col-sm-8">
                            {{ login_form.password }}
                          </div>
                        </div>
                        
                        <div class="form-group">
                          <div class="col-sm-offset-4 col-sm-8">
                            <input class="btn btn-primary login-local-form" type="submit" value="Log In"  />                        
                            <input type="hidden" name="next" value="/" />
                          </div>
                        </div>
                    </div><!--/ .login-local-form -->
                </form>

                {% if request.user.is_anonymous %}
                    <div class="pull-right">
                        <a href="/accounts/password_reset/">Forgot Password?</a>
                    </div>
                    <div style="clear: both"></div>
                {% endif %}                  
                {% if WIND_BASE %}
                    <form method="get" action="{{ WIND_BASE }}login">
                        {% csrf_token %}
                        <input type="hidden" name="service" value="{{ WIND_SERVICE }}" />
                        <input type="hidden" name="destination" value="http://{{ request.get_host }}/accounts/windlogin/?next=/" />
                        <input class="btn btn-default btn-small login-uni-form" type="submit" value="Columbia University Network ID (UNI)" />
                        <div style="clear: both;"></div>
                    </form>
                {% endif %}<!-- WIND -->
          </div><!-- /.modal-body -->
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
{% endif %}<!-- request.user.is_anonymous -->


<div class="banner-pl">
  <div class="container container-banner">
    <div class="banner-pl-bg">
      <div class="logo-pl">
        {% comment %}
            <a href="/"><span>Meaningful Consent</span></a>
        {% endcomment %}
      </div>
    </div><!--/ .banner-pl-bg -->
  </div><!--/ .container-banner -->
</div><!--/ .banner-pl -->

<div class="container container-pl" id="outer-container">
    <div class="content">
        {% block primarynav %}{% endblock %}
        {% block pagemode %}{% endblock %}
        <div class="row">
            <div class="col-md-12">                
                {% block content %}
                {% endblock %}
              
                {% block content-nav %}
                {% endblock %}                
            </div>
        </div> <!-- /.row -->
    </div> <!-- /.content -->
</div> <!-- /.container-pl -->

{% block footer %}
    <footer class="footer">
        <a href="http://ccnmtl.columbia.edu" target="_blank" title="Columbia Center for New Media Teaching and Learning"><img src="{{STATIC_URL}}img/logo_ccnmtl.png" /></a>
    </footer>
{% endblock %}

<script src="{{STATIC_URL}}js/underscore-min.js"></script>
<script src="{{STATIC_URL}}js/backbone-min.js"></script>
<script src="{{STATIC_URL}}bootstrap/js/bootstrap.min.js"></script>

{% if request.user.is_anonymous or request.user.profile.is_participant %}
    <script src="{{STATIC_URL}}js/app/login.js"></script>

    <script type="text/javascript"> 
        jQuery(document).ready(function() {
            var loginView = new LocalLoginView({
                el: jQuery("div#login-modal") 
            });
        });
    </script>
{% endif %}

{% block js %}{% endblock %}

{% if STAGING_ENV %}
    <div class="alert alert-danger alert-dismissable" style="position: fixed; bottom: 0px;">
    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
    <h4>Warning: Staging Site</h4>
    <p>You are viewing a staging version of this site, not the production site.</p>
    <p>This site was last updated on: <b>{{STAGING_DEPLOY_TIME}}</b></p>
    </div>
{% endif %}

{% if request.user.is_impersonate %}
<div class="alert alert-danger alert-dismissable" style="position: fixed; left: 0px; top: 75px">
<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
You are impersonating.<br />
<a class="btn" href="{% url 'impersonate-stop' %}">stop</a>
</div>
{% endif %}

{% if GA_CODE %}
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '{{GA_CODE}}', 'columbia.edu');
  ga('send', 'pageview');
</script>
{% endif %}

<!-- tooltips -->
<script>
  //add tooltip
  jQuery("span.tooltip-bottom").tooltip({
    placement: 'bottom'
  });
  jQuery("span.tooltip-top").tooltip({
  placement: 'top'
  });
</script>
</body>
</html>